using AspNetSandbox.Controllers;
using System;
using Xunit;

namespace AspNetSandbox.Tests
{
    public class WeatherForecastControllerTest
    {
        [Fact]
        public void ConvertResponseToWeatherForecastTest()
        {
            //Asume
            string content = "{\"lat\":35.6528,\"lon\":139.8395,\"timezone\":\"Asia/Tokyo\",\"timezone_offset\":32400,\"current\":{\"dt\":1630565358,\"sunrise\":1630527204,\"sunset\":1630573674,\"temp\":293.4,\"feels_like\":293.91,\"pressure\":1008,\"humidity\":93,\"dew_point\":292.23,\"uvi\":0.19,\"clouds\":75,\"visibility\":7000,\"wind_speed\":3.09,\"wind_deg\":10,\"weather\":[{\"id\":803,\"main\":\"Clouds\",\"description\":\"broken clouds\",\"icon\":\"04d\"}]},\"daily\":[{\"dt\":1630548000,\"sunrise\":1630527204,\"sunset\":1630573674,\"moonrise\":0,\"moonset\":1630563000,\"moon_phase\":0.84,\"temp\":{\"day\":293.59,\"min\":293.38,\"max\":294.3,\"night\":294.3,\"eve\":293.57,\"morn\":293.38},\"feels_like\":{\"day\":294.04,\"night\":294.59,\"eve\":294.04,\"morn\":293.81},\"pressure\":1009,\"humidity\":90,\"dew_point\":291.81,\"wind_speed\":6.3,\"wind_deg\":30,\"wind_gust\":9.9,\"weather\":[{\"id\":501,\"main\":\"Rain\",\"description\":\"moderate rain\",\"icon\":\"10d\"}],\"clouds\":100,\"pop\":1,\"rain\":17.45,\"uvi\":1.16},{\"dt\":1630634400,\"sunrise\":1630613649,\"sunset\":1630659990,\"moonrise\":1630597800,\"moonset\":1630652340,\"moon_phase\":0.87,\"temp\":{\"day\":293.44,\"min\":292.96,\"max\":294.44,\"night\":293.24,\"eve\":293.21,\"morn\":293.1},\"feels_like\":{\"day\":293.85,\"night\":293.63,\"eve\":293.67,\"morn\":293.5},\"pressure\":1011,\"humidity\":89,\"dew_point\":291.38,\"wind_speed\":6.29,\"wind_deg\":339,\"wind_gust\":8.52,\"weather\":[{\"id\":502,\"main\":\"Rain\",\"description\":\"heavy intensity rain\",\"icon\":\"10d\"}],\"clouds\":100,\"pop\":1,\"rain\":30.12,\"uvi\":0.53},{\"dt\":1630720800,\"sunrise\":1630700094,\"sunset\":1630746305,\"moonrise\":1630687740,\"moonset\":1630741320,\"moon_phase\":0.9,\"temp\":{\"day\":295.53,\"min\":293.38,\"max\":295.8,\"night\":294.79,\"eve\":295.51,\"morn\":293.99},\"feels_like\":{\"day\":295.89,\"night\":295.05,\"eve\":295.76,\"morn\":294.38},\"pressure\":1013,\"humidity\":79,\"dew_point\":291.66,\"wind_speed\":5.85,\"wind_deg\":349,\"wind_gust\":8.19,\"weather\":[{\"id\":500,\"main\":\"Rain\",\"description\":\"light rain\",\"icon\":\"10d\"}],\"clouds\":100,\"pop\":0.54,\"rain\":0.13,\"uvi\":0.5},{\"dt\":1630807200,\"sunrise\":1630786539,\"sunset\":1630832620,\"moonrise\":1630777920,\"moonset\":1630830060,\"moon_phase\":0.93,\"temp\":{\"day\":295.52,\"min\":293.57,\"max\":295.52,\"night\":293.57,\"eve\":293.68,\"morn\":294.51},\"feels_like\":{\"day\":295.74,\"night\":293.99,\"eve\":294.11,\"morn\":294.76},\"pressure\":1017,\"humidity\":74,\"dew_point\":290.6,\"wind_speed\":6.65,\"wind_deg\":40,\"wind_gust\":10.12,\"weather\":[{\"id\":501,\"main\":\"Rain\",\"description\":\"moderate rain\",\"icon\":\"10d\"}],\"clouds\":100,\"pop\":1,\"rain\":8.99,\"uvi\":1.7},{\"dt\":1630893600,\"sunrise\":1630872984,\"sunset\":1630918934,\"moonrise\":1630868220,\"moonset\":1630918560,\"moon_phase\":0.97,\"temp\":{\"day\":297.03,\"min\":292.75,\"max\":297.26,\"night\":294.83,\"eve\":295.93,\"morn\":292.75},\"feels_like\":{\"day\":297.07,\"night\":294.93,\"eve\":295.99,\"morn\":292.99},\"pressure\":1016,\"humidity\":61,\"dew_point\":288.88,\"wind_speed\":7.19,\"wind_deg\":50,\"wind_gust\":9.78,\"weather\":[{\"id\":500,\"main\":\"Rain\",\"description\":\"light rain\",\"icon\":\"10d\"}],\"clouds\":94,\"pop\":1,\"rain\":3.95,\"uvi\":5.6},{\"dt\":1630980000,\"sunrise\":1630959429,\"sunset\":1631005248,\"moonrise\":1630958580,\"moonset\":1631006820,\"moon_phase\":0,\"temp\":{\"day\":298.07,\"min\":293.08,\"max\":298.12,\"night\":295.18,\"eve\":296.24,\"morn\":293.08},\"feels_like\":{\"day\":297.87,\"night\":295.11,\"eve\":296.15,\"morn\":293.01},\"pressure\":1016,\"humidity\":48,\"dew_point\":286.08,\"wind_speed\":6.34,\"wind_deg\":13,\"wind_gust\":10.05,\"weather\":[{\"id\":803,\"main\":\"Clouds\",\"description\":\"broken clouds\",\"icon\":\"04d\"}],\"clouds\":70,\"pop\":0.05,\"uvi\":6},{\"dt\":1631066400,\"sunrise\":1631045874,\"sunset\":1631091561,\"moonrise\":1631049000,\"moonset\":1631095080,\"moon_phase\":0.04,\"temp\":{\"day\":296.84,\"min\":293.83,\"max\":298.59,\"night\":297.25,\"eve\":298.26,\"morn\":293.83},\"feels_like\":{\"day\":296.81,\"night\":297.67,\"eve\":298.65,\"morn\":293.7},\"pressure\":1013,\"humidity\":59,\"dew_point\":288.39,\"wind_speed\":3.21,\"wind_deg\":5,\"wind_gust\":4.11,\"weather\":[{\"id\":500,\"main\":\"Rain\",\"description\":\"light rain\",\"icon\":\"10d\"}],\"clouds\":100,\"pop\":0.42,\"rain\":0.42,\"uvi\":6},{\"dt\":1631152800,\"sunrise\":1631132318,\"sunset\":1631177874,\"moonrise\":1631139480,\"moonset\":1631183280,\"moon_phase\":0.08,\"temp\":{\"day\":301.2,\"min\":295.39,\"max\":302.81,\"night\":300.2,\"eve\":301.98,\"morn\":295.48},\"feels_like\":{\"day\":302.04,\"night\":301.76,\"eve\":304.05,\"morn\":295.81},\"pressure\":1010,\"humidity\":54,\"dew_point\":290.86,\"wind_speed\":4.62,\"wind_deg\":88,\"wind_gust\":6.47,\"weather\":[{\"id\":500,\"main\":\"Rain\",\"description\":\"light rain\",\"icon\":\"10d\"}],\"clouds\":39,\"pop\":0.66,\"rain\":1.5,\"uvi\":6}]}";
            var controller = new WeatherForecastController();


            // Act
            var output = controller.ConvertResponseToWeatherForecast(content);

            // Assert
            var weatherForecastForTomorrow = ((WeatherForecast[])output)[0];
            Assert.Equal("Rain", weatherForecastForTomorrow.Summary);
            Assert.Equal(20, weatherForecastForTomorrow.TemperatureC);
            Assert.Equal(new DateTime(2021, 9, 3), weatherForecastForTomorrow.Date);
        }

        [Fact]
        public void ConvertResponseToWeatherAfterTormorrowForecastTest()
        {
            //Asume
            string content = "{\"lat\":35.6528,\"lon\":139.8395,\"timezone\":\"Asia/Tokyo\",\"timezone_offset\":32400,\"current\":{\"dt\":1630565358,\"sunrise\":1630527204,\"sunset\":1630573674,\"temp\":293.4,\"feels_like\":293.91,\"pressure\":1008,\"humidity\":93,\"dew_point\":292.23,\"uvi\":0.19,\"clouds\":75,\"visibility\":7000,\"wind_speed\":3.09,\"wind_deg\":10,\"weather\":[{\"id\":803,\"main\":\"Clouds\",\"description\":\"broken clouds\",\"icon\":\"04d\"}]},\"daily\":[{\"dt\":1630548000,\"sunrise\":1630527204,\"sunset\":1630573674,\"moonrise\":0,\"moonset\":1630563000,\"moon_phase\":0.84,\"temp\":{\"day\":293.59,\"min\":293.38,\"max\":294.3,\"night\":294.3,\"eve\":293.57,\"morn\":293.38},\"feels_like\":{\"day\":294.04,\"night\":294.59,\"eve\":294.04,\"morn\":293.81},\"pressure\":1009,\"humidity\":90,\"dew_point\":291.81,\"wind_speed\":6.3,\"wind_deg\":30,\"wind_gust\":9.9,\"weather\":[{\"id\":501,\"main\":\"Rain\",\"description\":\"moderate rain\",\"icon\":\"10d\"}],\"clouds\":100,\"pop\":1,\"rain\":17.45,\"uvi\":1.16},{\"dt\":1630634400,\"sunrise\":1630613649,\"sunset\":1630659990,\"moonrise\":1630597800,\"moonset\":1630652340,\"moon_phase\":0.87,\"temp\":{\"day\":293.44,\"min\":292.96,\"max\":294.44,\"night\":293.24,\"eve\":293.21,\"morn\":293.1},\"feels_like\":{\"day\":293.85,\"night\":293.63,\"eve\":293.67,\"morn\":293.5},\"pressure\":1011,\"humidity\":89,\"dew_point\":291.38,\"wind_speed\":6.29,\"wind_deg\":339,\"wind_gust\":8.52,\"weather\":[{\"id\":502,\"main\":\"Rain\",\"description\":\"heavy intensity rain\",\"icon\":\"10d\"}],\"clouds\":100,\"pop\":1,\"rain\":30.12,\"uvi\":0.53},{\"dt\":1630720800,\"sunrise\":1630700094,\"sunset\":1630746305,\"moonrise\":1630687740,\"moonset\":1630741320,\"moon_phase\":0.9,\"temp\":{\"day\":295.53,\"min\":293.38,\"max\":295.8,\"night\":294.79,\"eve\":295.51,\"morn\":293.99},\"feels_like\":{\"day\":295.89,\"night\":295.05,\"eve\":295.76,\"morn\":294.38},\"pressure\":1013,\"humidity\":79,\"dew_point\":291.66,\"wind_speed\":5.85,\"wind_deg\":349,\"wind_gust\":8.19,\"weather\":[{\"id\":500,\"main\":\"Rain\",\"description\":\"light rain\",\"icon\":\"10d\"}],\"clouds\":100,\"pop\":0.54,\"rain\":0.13,\"uvi\":0.5},{\"dt\":1630807200,\"sunrise\":1630786539,\"sunset\":1630832620,\"moonrise\":1630777920,\"moonset\":1630830060,\"moon_phase\":0.93,\"temp\":{\"day\":295.52,\"min\":293.57,\"max\":295.52,\"night\":293.57,\"eve\":293.68,\"morn\":294.51},\"feels_like\":{\"day\":295.74,\"night\":293.99,\"eve\":294.11,\"morn\":294.76},\"pressure\":1017,\"humidity\":74,\"dew_point\":290.6,\"wind_speed\":6.65,\"wind_deg\":40,\"wind_gust\":10.12,\"weather\":[{\"id\":501,\"main\":\"Rain\",\"description\":\"moderate rain\",\"icon\":\"10d\"}],\"clouds\":100,\"pop\":1,\"rain\":8.99,\"uvi\":1.7},{\"dt\":1630893600,\"sunrise\":1630872984,\"sunset\":1630918934,\"moonrise\":1630868220,\"moonset\":1630918560,\"moon_phase\":0.97,\"temp\":{\"day\":297.03,\"min\":292.75,\"max\":297.26,\"night\":294.83,\"eve\":295.93,\"morn\":292.75},\"feels_like\":{\"day\":297.07,\"night\":294.93,\"eve\":295.99,\"morn\":292.99},\"pressure\":1016,\"humidity\":61,\"dew_point\":288.88,\"wind_speed\":7.19,\"wind_deg\":50,\"wind_gust\":9.78,\"weather\":[{\"id\":500,\"main\":\"Rain\",\"description\":\"light rain\",\"icon\":\"10d\"}],\"clouds\":94,\"pop\":1,\"rain\":3.95,\"uvi\":5.6},{\"dt\":1630980000,\"sunrise\":1630959429,\"sunset\":1631005248,\"moonrise\":1630958580,\"moonset\":1631006820,\"moon_phase\":0,\"temp\":{\"day\":298.07,\"min\":293.08,\"max\":298.12,\"night\":295.18,\"eve\":296.24,\"morn\":293.08},\"feels_like\":{\"day\":297.87,\"night\":295.11,\"eve\":296.15,\"morn\":293.01},\"pressure\":1016,\"humidity\":48,\"dew_point\":286.08,\"wind_speed\":6.34,\"wind_deg\":13,\"wind_gust\":10.05,\"weather\":[{\"id\":803,\"main\":\"Clouds\",\"description\":\"broken clouds\",\"icon\":\"04d\"}],\"clouds\":70,\"pop\":0.05,\"uvi\":6},{\"dt\":1631066400,\"sunrise\":1631045874,\"sunset\":1631091561,\"moonrise\":1631049000,\"moonset\":1631095080,\"moon_phase\":0.04,\"temp\":{\"day\":296.84,\"min\":293.83,\"max\":298.59,\"night\":297.25,\"eve\":298.26,\"morn\":293.83},\"feels_like\":{\"day\":296.81,\"night\":297.67,\"eve\":298.65,\"morn\":293.7},\"pressure\":1013,\"humidity\":59,\"dew_point\":288.39,\"wind_speed\":3.21,\"wind_deg\":5,\"wind_gust\":4.11,\"weather\":[{\"id\":500,\"main\":\"Rain\",\"description\":\"light rain\",\"icon\":\"10d\"}],\"clouds\":100,\"pop\":0.42,\"rain\":0.42,\"uvi\":6},{\"dt\":1631152800,\"sunrise\":1631132318,\"sunset\":1631177874,\"moonrise\":1631139480,\"moonset\":1631183280,\"moon_phase\":0.08,\"temp\":{\"day\":301.2,\"min\":295.39,\"max\":302.81,\"night\":300.2,\"eve\":301.98,\"morn\":295.48},\"feels_like\":{\"day\":302.04,\"night\":301.76,\"eve\":304.05,\"morn\":295.81},\"pressure\":1010,\"humidity\":54,\"dew_point\":290.86,\"wind_speed\":4.62,\"wind_deg\":88,\"wind_gust\":6.47,\"weather\":[{\"id\":500,\"main\":\"Rain\",\"description\":\"light rain\",\"icon\":\"10d\"}],\"clouds\":39,\"pop\":0.66,\"rain\":1.5,\"uvi\":6}]}";
            var controller = new WeatherForecastController();


            // Act
            var output = controller.ConvertResponseToWeatherForecast(content);

            // Assert
            var weatherForecastAfterTomorrow = ((WeatherForecast[])output)[1];
            Assert.Equal("Rain", weatherForecastAfterTomorrow.Summary);
            Assert.Equal(22, weatherForecastAfterTomorrow.TemperatureC);
            Assert.Equal(new DateTime(2021, 9, 4), weatherForecastAfterTomorrow.Date);
        }

    }
}